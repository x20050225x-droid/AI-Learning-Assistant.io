<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI å­¸ç¿’åŠ©ç† - å°ˆé¡Œç¤ºç¯„ç‰ˆ</title>
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --bg: #f5f7fa;
            --text: #2d3436;
            --success: #00b894;
            --error: #d63031;
            --primary: #667eea;
        }

        body {
            font-family: 'PingFang TC', 'Microsoft JhengHei', system-ui, sans-serif;
            background: var(--bg);
            background-attachment: fixed;
            color: var(--text);
            margin: 0;
            padding: 40px 20px;
            display: flex;
            justify-content: center;
        }

        .container { width: 100%; max-width: 850px; }

        h1 { 
            font-size: 2.5em; 
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
            text-align: center;
        }

        .subtitle {
            color: #636e72;
            font-weight: 500;
            letter-spacing: 1px;
            border-bottom: 2px solid #dfe6e9;
            padding-bottom: 15px;
            margin-bottom: 25px;
            display: inline-block;
            width: 100%;
            text-align: center;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.05);
            border: 1px solid rgba(255,255,255,0.3);
            margin-bottom: 20px;
        }

        .hidden { display: none; }

        label { display: block; font-size: 1.1em; margin-bottom: 10px; color: #2d3436; font-weight: bold; }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #edf2f7;
            border-radius: 8px;
            margin-bottom: 15px;
            box-sizing: border-box;
            transition: all 0.3s ease;
            background: #f8fafc;
        }

        input:focus, select:focus, textarea:focus {
            border-color: #667eea;
            background: #fff;
            outline: none;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        button {
            background: var(--primary-gradient);
            color: white;
            border: none;
            padding: 18px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            letter-spacing: 2px;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 15px rgba(118, 75, 162, 0.3);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(118, 75, 162, 0.4);
            opacity: 0.95;
        }

        button:disabled { background: #ccc; cursor: not-allowed; transform: none; box-shadow: none; }

        .option-btn {
            background: white;
            border: 2px solid #edf2f7;
            text-align: left;
            margin-bottom: 10px;
            color: var(--text);
            box-shadow: none;
            padding: 15px;
        }

        .option-btn:hover:not(:disabled) { border-color: var(--primary); background: #f0f4ff; }

        .option-btn.correct { background: var(--success); color: white; border-color: var(--success); }
        .option-btn.wrong { background: var(--error); color: white; border-color: var(--error); }

        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0; }
        .stat-box { 
            background: #fff; 
            padding: 20px; 
            border-radius: 12px; 
            text-align: center; 
            border: 1px solid #edf2f7;
            transition: 0.3s;
        }
        .stat-box:hover { border-color: #667eea; transform: scale(1.02); }
        .stat-value { font-size: 1.8em; font-weight: bold; color: var(--primary); display: block; }
    </style>
</head>
<body>

<div class="container">
    <h1>AI å­¸ç¿’åŠ©ç†</h1>
    <div class="subtitle">å­¸è™Ÿï¼šC112193156 | å§“åï¼šé™³å† äº¦</div>

    <div id="setup-panel" class="card">
        <label>Gemini API Key</label>
        <input type="password" id="apiKey" placeholder="è«‹è²¼ä¸Š AIza... é–‹é ­çš„é‡‘é‘°">
        
        <label>å­¸ç¿’æ•™æå…§å®¹</label>
        <textarea id="content" rows="6" placeholder="è«‹è²¼ä¸Šæ¬²ç”Ÿæˆçš„æ•™ææ–‡å­—..."></textarea>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
            <div>
                <label>é¡Œå‹</label>
                <select id="qType">
                    <option value="é¸æ“‡é¡Œ">é¸æ“‡é¡Œ</option>
                    <option value="æ˜¯éé¡Œ">æ˜¯éé¡Œ</option>
                </select>
            </div>
            <div>
                <label>é›£åº¦</label>
                <select id="difficulty">
                    <option value="ç°¡å–®">ç°¡å–®</option>
                    <option value="ä¸­ç­‰">ä¸­ç­‰</option>
                    <option value="å›°é›£">å›°é›£</option>
                </select>
            </div>
            <div>
                <label>é¡Œæ•¸</label>
                <input type="number" id="qCount" value="3" min="1" max="5">
            </div>
        </div>
        <button id="genBtn" onclick="generateQuiz()">ğŸš€ ç”Ÿæˆå®¢è£½åŒ–é¡Œåº«</button>
    </div>

    <div id="quiz-panel" class="card hidden">
        <div style="display: flex; justify-content: space-between; color: #666; margin-bottom: 15px; font-weight: 500;">
            <span id="progress">é¡Œç›® 1/3</span>
            <span id="timer">æº–å‚™å°±ç·’</span>
        </div>
        <h3 id="qText" style="margin-top: 0; line-height: 1.5;">æ­£åœ¨è¼‰å…¥é¡Œç›®...</h3>
        <div id="options"></div>
        <div id="feedback" class="hidden" style="margin-top: 20px; padding: 20px; background: #f0f4ff; border-radius: 12px; border-left: 5px solid var(--primary);">
            <p id="explain" style="margin-top: 0;"></p>
            <button onclick="nextQ()" style="width: auto; padding: 10px 30px;">ä¸‹ä¸€é¡Œ</button>
        </div>
    </div>

    <div id="result-panel" class="card hidden">
        <h2 style="text-align: center; margin-top: 0;">å­¸ç¿’åˆ†æå ±å‘Š</h2>
        <div class="stats-grid">
            <div class="stat-box">æ­£ç¢ºç‡<span class="stat-value" id="resScore">0%</span></div>
            <div class="stat-box">å¹³å‡ç”¨æ™‚<span class="stat-value" id="resTime">0s</span></div>
        </div>
        <p id="aiAdvice" style="background: #fff3e0; padding: 20px; border-radius: 12px; line-height: 1.6; border-left: 5px solid #ff9800;"></p>
        <button onclick="location.reload()" style="margin-top: 10px;">ğŸ”„ é‡æ–°é–‹å§‹</button>
    </div>
</div>

<script>
    let questions = [];
    let curIdx = 0;
    let score = 0;
    let qStartTime;
    let timeLogs = [];

    async function generateQuiz() {
        const key = document.getElementById('apiKey').value.trim();
        const text = document.getElementById('content').value.trim();
        const type = document.getElementById('qType').value;
        const diff = document.getElementById('difficulty').value;
        const count = document.getElementById('qCount').value;

        if (!key || !text) return alert("è«‹å¡«å¯«é‡‘é‘°èˆ‡å…§å®¹ï¼");

        const btn = document.getElementById('genBtn');
        btn.disabled = true;
        btn.textContent = "AI æ­£åœ¨åˆ†ææ•™æä¸¦å‡ºé¡Œ...";

        const prompt = `ä½ æ˜¯ä¸€å€‹å°ˆæ¥­æ•™å¸«ã€‚è«‹æ ¹æ“šæ•™æå…§å®¹ï¼š${text}ï¼Œè¨­è¨ˆ ${count} é¡Œ ${diff} é›£åº¦çš„ ${type}ã€‚è«‹åš´æ ¼ä»¥ç´” JSON é™£åˆ—æ ¼å¼å›å‚³ï¼Œæ ¼å¼ç‚ºï¼š[{"question":"é¡Œç›®","options":["A","B","C","D"],"answer":0,"explanation":"è§£æ"}]`;

        try {
            const resp = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${key}`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ 
                    contents: [{ parts: [{ text: prompt }] }],
                    generationConfig: { responseMimeType: "application/json" }
                })
            });
            const data = await resp.json();
            const raw = data.candidates[0].content.parts[0].text;
            questions = JSON.parse(raw);
            
            document.getElementById('setup-panel').classList.add('hidden');
            document.getElementById('quiz-panel').classList.remove('hidden');
            loadQ();
        } catch (e) {
            console.error(e);
            alert("ç”Ÿæˆå¤±æ•—ï¼Œè«‹æª¢æŸ¥é‡‘é‘°æˆ–ç¶²è·¯é€£ç·šã€‚");
        } finally {
            btn.disabled = false;
            btn.textContent = "ğŸš€ ç”Ÿæˆå®¢è£½åŒ–é¡Œåº«";
        }
    }

    function loadQ() {
        if (curIdx >= questions.length) return showResult();
        qStartTime = Date.now();
        const q = questions[curIdx];
        document.getElementById('progress').textContent = `é¡Œç›® ${curIdx + 1} / ${questions.length}`;
        document.getElementById('qText').textContent = q.question;
        document.getElementById('feedback').classList.add('hidden');
        
        const container = document.getElementById('options');
        container.innerHTML = '';
        q.options.forEach((opt, i) => {
            const b = document.createElement('button');
            b.className = 'option-btn';
            b.textContent = opt;
            b.onclick = () => check(i, b);
            container.appendChild(b);
        });
    }

    function check(idx, btn) {
        const q = questions[curIdx];
        const timeSpent = (Date.now() - qStartTime) / 1000;
        timeLogs.push(timeSpent);
        
        const btns = document.querySelectorAll('.option-btn');
        btns.forEach(b => b.disabled = true);

        if (idx === q.answer) {
            btn.classList.add('correct');
            score++;
        } else {
            btn.classList.add('wrong');
            if(btns[q.answer]) btns[q.answer].classList.add('correct');
        }
        document.getElementById('explain').textContent = "ğŸ’¡ è§£æï¼š" + q.explanation;
        document.getElementById('feedback').classList.remove('hidden');
    }

    function nextQ() { curIdx++; loadQ(); }

    function showResult() {
        document.getElementById('quiz-panel').classList.add('hidden');
        document.getElementById('result-panel').classList.remove('hidden');
        const acc = Math.round((score / questions.length) * 100);
        const avgT = (timeLogs.reduce((a, b) => a + b, 0) / questions.length).toFixed(1);
        
        document.getElementById('resScore').textContent = acc + "%";
        document.getElementById('resTime').textContent = avgT + "s";
        
        let advice = acc >= 80 ? "å¤ªç¥å•¦ï¼ä½ å·²ç²¾é€šæ­¤æ•™æå…§å®¹ã€‚" : 
                     acc >= 60 ? "è¡¨ç¾ä¸éŒ¯ï¼Œå»ºè­°é‡å°è§£æç¨ä½œè¤‡ç¿’ã€‚" : "å»ºè­°é‡æ–°é–±è®€æ•™æä¸¦è£œå¼·è–„å¼±é»ã€‚";
        document.getElementById('aiAdvice').textContent = "ğŸ¤– AI å­¸ç¿’å»ºè­°ï¼š\n" + advice;
    }
</script>
</body>
</html>
