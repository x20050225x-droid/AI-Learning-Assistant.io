<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI å­¸ç¿’åŠ©ç† - å°ˆé¡Œç¤ºç¯„ç‰ˆ</title>
    <style>
        :root {
            --primary: #4285f4;
            --success: #34a853;
            --error: #ea4335;
            --bg: #f8f9fa;
            --text: #202124;
        }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            padding: 20px;
            display: flex;
            justify-content: center;
        }
        .container { width: 100%; max-width: 800px; }
        .card {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .hidden { display: none; }
        h1 { text-align: center; color: var(--primary); margin-bottom: 5px; }
        .subtitle { text-align: center; color: #666; font-size: 0.9em; margin-bottom: 25px; }
        
        label { display: block; margin-bottom: 8px; font-weight: bold; }
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-bottom: 15px;
            box-sizing: border-box;
        }
        button {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            transition: 0.3s;
        }
        button:hover { background-color: #3367d6; }
        
        .option-btn {
            background: white;
            border: 2px solid #e0e0e0;
            text-align: left;
            margin-bottom: 10px;
            color: var(--text);
        }
        .option-btn.correct { background: var(--success); color: white; border-color: var(--success); }
        .option-btn.wrong { background: var(--error); color: white; border-color: var(--error); }
        
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0; }
        .stat-box { background: #f1f3f4; padding: 15px; border-radius: 8px; text-align: center; }
        .stat-value { font-size: 1.5em; font-weight: bold; color: var(--primary); display: block; }
    </style>
</head>
<body>

<div class="container">
    <h1>AI å­¸ç¿’åŠ©ç†</h1>
    <div class="subtitle">å­¸è™Ÿï¼šC112193156 | [cite_start]å§“åï¼šé™³å† äº¦ [cite: 3, 4]</div>

    <div id="setup-panel" class="card">
        <label>Gemini API Key</label>
        <input type="password" id="apiKey" placeholder="è«‹è²¼ä¸Š AIza... é–‹é ­çš„é‡‘é‘°">
        
        <label>å­¸ç¿’æ•™æå…§å®¹</label>
        <textarea id="content" rows="6" placeholder="è«‹è²¼ä¸Šæ¬²ç”Ÿæˆçš„æ•™ææ–‡å­—..."></textarea>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;">
            <div>
                <label>é¡Œå‹</label>
                <select id="qType">
                    <option value="é¸æ“‡é¡Œ">é¸æ“‡é¡Œ</option>
                    <option value="æ˜¯éé¡Œ">æ˜¯éé¡Œ</option>
                </select>
            </div>
            <div>
                <label>é›£åº¦</label>
                <select id="difficulty">
                    <option value="ç°¡å–®">ç°¡å–®</option>
                    <option value="ä¸­ç­‰">ä¸­ç­‰</option>
                    <option value="å›°é›£">å›°é›£</option>
                </select>
            </div>
            <div>
                <label>é¡Œæ•¸</label>
                <input type="number" id="qCount" value="3" min="1" max="5">
            </div>
        </div>
        [cite_start]<button id="genBtn" onclick="generateQuiz()">ğŸš€ ç”Ÿæˆå®¢è£½åŒ–é¡Œåº« [cite: 17]</button>
    </div>

    <div id="quiz-panel" class="card hidden">
        <div style="display: flex; justify-content: space-between; color: #666; margin-bottom: 15px;">
            <span id="progress">é¡Œç›® 1/3</span>
            <span id="timer">ç”¨æ™‚: 0s</span>
        </div>
        <h3 id="qText">æ­£åœ¨è¼‰å…¥é¡Œç›®...</h3>
        <div id="options"></div>
        <div id="feedback" class="hidden" style="margin-top: 20px; padding: 15px; background: #e8f0fe; border-left: 5px solid var(--primary);">
            <p id="explain"></p>
            <button onclick="nextQ()" style="width: auto; padding: 10px 25px;">ä¸‹ä¸€é¡Œ</button>
        </div>
    </div>

    <div id="result-panel" class="card hidden">
        [cite_start]<h2 style="text-align: center;">å­¸ç¿’åˆ†æå ±å‘Š [cite: 10]</h2>
        <div class="stats-grid">
            <div class="stat-box">æ­£ç¢ºç‡<span class="stat-value" id="resScore">0%</span></div>
            <div class="stat-box">å¹³å‡ç”¨æ™‚<span class="stat-value" id="resTime">0s</span></div>
        </div>
        <p id="aiAdvice" style="background: #fff3e0; padding: 15px; border-radius: 8px;"></p>
        <button onclick="location.reload()">ğŸ”„ é‡æ–°é–‹å§‹</button>
    </div>
</div>

<script>
    let questions = [];
    let curIdx = 0;
    let score = 0;
    let startTime, qStartTime;
    let timeLogs = [];

    async function generateQuiz() {
        const key = document.getElementById('apiKey').value;
        const text = document.getElementById('content').value;
        const type = document.getElementById('qType').value;
        const diff = document.getElementById('difficulty').value;
        const count = document.getElementById('qCount').value;

        if(!key || !text) return alert("è«‹å¡«å¯«é‡‘é‘°èˆ‡å…§å®¹ï¼");

        const btn = document.getElementById('genBtn');
        btn.disabled = true;
        btn.textContent = "AI æ­£åœ¨åˆ†ææ•™æä¸¦å‡ºé¡Œ...";

        const prompt = `ä½ æ˜¯ä¸€å€‹å°ˆæ¥­æ•™å¸«ã€‚è«‹æ ¹æ“šæ•™æå…§å®¹ï¼š${text}ï¼Œè¨­è¨ˆ ${count} é¡Œ ${diff} é›£åº¦çš„ ${type}ã€‚è«‹åš´æ ¼ä»¥ç´” JSON é™£åˆ—æ ¼å¼å›å‚³ï¼Œæ ¼å¼ç‚ºï¼š[{"question":"é¡Œç›®","options":["A","B","C","D"],"answer":0,"explanation":"è§£æ"}]`;

        try {
            const resp = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${key}`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
            });
            const data = await resp.json();
            const raw = data.candidates[0].content.parts[0].text.replace(/```json/g, '').replace(/```/g, '').trim();
            questions = JSON.parse(raw);
            
            document.getElementById('setup-panel').classList.add('hidden');
            document.getElementById('quiz-panel').classList.remove('hidden');
            startTime = Date.now();
            loadQ();
        } catch (e) {
            alert("ç”Ÿæˆå¤±æ•—ï¼Œè«‹æª¢æŸ¥é‡‘é‘°æˆ–å…§å®¹æ ¼å¼ã€‚");
            btn.disabled = false;
            btn.textContent = "ğŸš€ ç”Ÿæˆå®¢è£½åŒ–é¡Œåº«";
        }
    }

    function loadQ() {
        if(curIdx >= questions.length) return showResult();
        qStartTime = Date.now();
        const q = questions[curIdx];
        document.getElementById('progress').textContent = `é¡Œç›® ${curIdx+1} / ${questions.length}`;
        document.getElementById('qText').textContent = q.question;
        document.getElementById('feedback').classList.add('hidden');
        
        const container = document.getElementById('options');
        container.innerHTML = '';
        q.options.forEach((opt, i) => {
            const b = document.createElement('button');
            b.className = 'option-btn';
            b.textContent = opt;
            b.onclick = () => check(i, b);
            container.appendChild(b);
        });
    }

    function check(idx, btn) {
        const q = questions[curIdx];
        const timeSpent = (Date.now() - qStartTime) / 1000;
        timeLogs.push(timeSpent);
        
        const btns = document.querySelectorAll('.option-btn');
        btns.forEach(b => b.disabled = true);

        if(idx === q.answer) {
            btn.classList.add('correct');
            score++;
        } else {
            btn.classList.add('wrong');
            btns[q.answer].classList.add('correct');
        }
        document.getElementById('explain').textContent = "ğŸ’¡ è§£æï¼š" + q.explanation;
        document.getElementById('feedback').classList.remove('hidden');
    }

    function nextQ() { curIdx++; loadQ(); }

    function showResult() {
        document.getElementById('quiz-panel').classList.add('hidden');
        document.getElementById('result-panel').classList.remove('hidden');
        const acc = Math.round((score/questions.length)*100);
        const avgT = (timeLogs.reduce((a,b)=>a+b,0)/questions.length).toFixed(1);
        
        document.getElementById('resScore').textContent = acc + "%";
        document.getElementById('resTime').textContent = avgT + "s";
        
        let advice = acc >= 80 ? "æ­å–œï¼ä½ å·²ç²¾é€šæ­¤æ•™æå…§å®¹ã€‚" : "å»ºè­°é‡å°è§£æå…§å®¹é‡æ–°é–±è®€æ•™æï¼Œè£œå¼·è–„å¼±é»ã€‚";
        document.getElementById('aiAdvice').textContent = "ğŸ¤– AI å­¸ç¿’å»ºè­°ï¼š\n" + advice;
    }
</script>
</body>
</html>